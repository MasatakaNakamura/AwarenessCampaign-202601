**概要**
- **目的**: `docs/20260126_002.md` の内容に基づき、AI（あなた）が実際に実装作業を行う前提での「作業指示書」を作成する。
- **対象**: 1on1管理システムに追加する API エンドポイント `GET /api/oneonones/{id}/history` および関連するマイグレーション、エンティティ、リポジトリ、サービス、DTO、コントローラ、テスト、OpenAPI ドキュメントの反映。

**前提条件**
- **リポジトリ**: ワークスペースルートにある本プロジェクトを使用（Gradle ベースの Spring Boot）。
- **参照文書**: [docs/20260126_002.md](docs/20260126_002.md)
- **環境**: Linux 環境で `./gradlew test` が実行できること。

**作業一覧（AI が実行する順序で）**
1. **DB マイグレーション確認**: `one_on_one_history` テーブルのマイグレーションファイルが `src/main/resources/db/migration` に存在することを確認。必要ならマイグレーションを追加/修正する。
2. **エンティティ実装**: 履歴用エンティティ（例: `OneOnOneHistory`）の確認・修正。関係（FK）や timestamp などのフィールドを見直す。
3. **リポジトリ実装**: 履歴取得用のリポジトリインターフェースを確認（例: `OneOnOneHistoryRepository`）。`findByOneOnOneIdOrderByCreatedAtDesc()` のような検索メソッドを実装。
4. **サービス実装**: 履歴取得ロジックを `OneOnOneHistoryService` に実装。存在しない `id` の場合は `EntityNotFoundException` 相当を投げるか Optional を返す実装にする。
5. **DTO 定義**: API レスポンス用 DTO（例: `OneOnOneHistoryDto`）を定義し、エンティティ->DTO のマッピングを実装。
6. **コントローラ実装**: `GET /api/oneonones/{id}/history` をコントローラに追加。成功時は `200 OK` と履歴リスト、該当 `id` が存在しない場合は `404 Not Found` を返す。
7. **テスト追加/修正**: MockMvc テストを追加して次を検証する。
   - 正常系: `id` が存在する場合に履歴が正しく返ること（レスポンスボディのスキーマと内容）。
   - 異常系: `id` が存在しない場合に `404` が返ること。
8. **OpenAPI 更新**: `openapi.yaml`（またはプロジェクト内の OpenAPI 定義）にエンドポイントとレスポンススキーマを追加。
9. **ビルド & テスト**: `./gradlew test` を実行して、既存テストと追加テストが通ることを確認。
10. **ドキュメント反映**: `docs/` 内の関連ドキュメントに実装状況を反映（必要なら `docs/20260126_002.md` を更新して完了済みフラグを付与）。

**詳細手順（実行コマンド例）**
- ローカルでユニットテスト実行: `./gradlew test --tests "**OneOnOne*"`
- 全テスト実行: `./gradlew test`
- アプリ起動（必要に応じて）: `./gradlew bootRun`

**期待する成果物**
- `src/main/java/.../entity/OneOnOneHistory.java`（既存なら修正）
- `src/main/java/.../repository/OneOnOneHistoryRepository.java`
- `src/main/java/.../service/OneOnOneHistoryService.java`
- `src/main/java/.../dto/OneOnOneHistoryDto.java`
- `src/main/java/.../controller/OneOnOneController.java`（または履歴専用コントローラにエンドポイント追加）
- `src/test/java/.../controller/OneOnOneControllerHistoryTest.java`（MockMvc テスト）
- `src/main/resources/openapi.yaml`（または該当 OpenAPI 定義ファイル）にエンドポイントを追加

**検証項目**
- API 呼び出しで期待するフィールドが返ること（例: `id`, `status`, `changedBy`, `changedAt`, `comment` など）
- 異常系のステータスコード（404）を確認
- マイグレーション実行後に `one_on_one_history` テーブルのスキーマが期待通りであること

**リスク・ロールバック**
- マイグレーションによるデータ不整合が発生した場合は、直近のマイグレーションをロールバック（本番では注意）。ローカルでの検証は専用 DB（テスト DB）で行うこと。

**担当と所要時間（目安）**
- **実装（AI）**: 2–4 時間（既存コードの状況による）
- **テストと調整**: 1–2 時間
- **ドキュメント更新**: 0.5 時間

**提出・確認**
- gitの作業は人間が行うので、一切行わないでください。
